<h2>
    % if recipe.id:
        <a href="/recipe/{{str(recipe.id)}}-{{str(recipe.title.lower())}}">{{recipe.title}}</a>
    % else:
        New Recipe
    % end
</h2>

% selected = 'selected="selected"'

<form action="/manage/recipe{{'/'+str(recipe.id) if recipe.id else ''}}" method="post" enctype="multipart/form-data">
    <fieldset>
        <legend>{{'Edit' if recipe.id else 'New'}} Recipe</legend>

        <div>
            <label for="rating">Rating:</label>
            <select id="rating" name="rating">
                <option value="-1"> </option>
                <option value="0" {{!selected if recipe.rating is 0 else ''}}>☆</option>
                <option value="1" {{!selected if recipe.rating is 1 else ''}}>★</option>
                <option value="2" {{!selected if recipe.rating is 2 else ''}}>★★</option>
                <option value="3" {{!selected if recipe.rating is 3 else ''}}>★★★</option>
            </select>
        </div>

        <div>
            <label for="categories">Category:</label>
            <select id="categories" name="categories" multiple="multiple">
                <option value="-1"> </option>
                % category_ids = [category.id for category in recipe.categories]
                % for category in categories:
                    <option value="{{category.id}}"
                            {{!selected if category.id in category_ids else ''}}>
                        {{category.name}}
                    </option>
                % end
            </select>
        </div>

        <div>
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" value="{{recipe.title}}" />
        </div>

        % synonym_counter = 0
        <div id="synonyms">
            % for synonym in recipe.synonyms:
                <div>
                    <label for="synonym-{{synonym_counter}}">Synonym {{synonym_counter + 1}}:</label>
                    <input type="text" id="synonym-{{synonym_counter}}" name="synonym-{{synonym_counter}}" value="{{synonym.name}}" />
                </div>
                % synonym_counter += 1
            % end
            % if not recipe.synonyms:
                <div>
                    <label for="synonym-0">Synonym 1:</label>
                    <input type="text" id="synonym-0" name="synonym-0" value="" />
                </div>
                % synonym_counter += 1
            % end
        </div>
        <div>
            <input type="hidden" id="synonym-counter" name="synonym-counter" value="{{synonym_counter}}" />
            <button id="add-synonym">Add Synonym</button>
        </div>

        <div>
            <label for="serving-size">Serving Size:</label>
            <input type="text" id="serving-size" name="serving-size" value="{{recipe.serving_size}}" />
        </div>

        <div>
            <label for="ingredients">Ingredients:</label>
            <textarea id="ingredients" name="ingredients">{{recipe.ingredients}}</textarea>
        </div>

        <div>
            <label for="description">Preparation:</label>
            <textarea id="description" name="description">{{recipe.description}}</textarea>
        </div>

        <div>
            <label for="info">Info:</label>
            <textarea id="info" name="info">{{recipe.info}}</textarea>
        </div>

        <div>
            <label for="tags">Tags:</label>
            <select id="tags" name="tags" multiple="multiple">
                <option> </option>
                % tag_ids = [tag.id for tag in recipe.tags]
                % for tag in tags:
                    <optgroup label="{{tag.name}}">
                        <option value="{{tag.id}}"
                                {{!selected if tag.id in tag_ids else ''}}>
                            {{tag.name}}
                        </option>
                        % for synonym in tag.synonyms:
                            <option value="{{synonym.id}}"
                                    {{!selected if synonym.id in tag_ids else ''}}>
                                {{synonym.name}}
                            </option>
                        % end
                    </optgroup>
                % end
            </select>
        </div>

        % url_counter = 0
        <div id="urls">
            % for url in recipe.urls:
                <div>
                    <label for="url-name-{{url_counter}}">Name of Link {{url_counter + 1}}:</label>
                    <input type="text" id="url-name-{{url_counter}}" name="url-name-{{url_counter}}" value="{{url.name}}" />
                </div>
                <div>
                    <label for="url-url-{{url_counter}}">Link {{url_counter + 1}}:</label>
                    <input type="text" id="url-url-{{url_counter}}" name="url-url-{{url_counter}}" value="{{url.url}}" />
                </div>
                % url_counter += 1
            % end
            % if not recipe.urls:
                <div>
                    <label for="url-name-0">Name of Link 1:</label>
                    <input type="text" id="url-name-0" name="url-name-0" value="" />
                </div>
                <div>
                    <label for="url-url-0">Link 1:</label>
                    <input type="text" id="url-url-0" name="url-url-0" value="" />
                </div>
                % url_counter += 1
            % end
        </div>
        <div>
            <input type="hidden" id="url-counter" name="url-counter" value="{{url_counter}}" />
            <button id="add-url">Add Link</button>
        </div>

        % image_counter = 0
        <div id="images">
            % for image in recipe.images:
                <div id="image-{{image_counter}}">
                    <label>Image {{image_counter + 1}}:</label>
                    <img src="{{image.path}}" alt="{{image.path}}" />
                    <input type="hidden" name="image-{{image_counter}}" value="{{image.path}}" />
                    <button class="delete-image" data-rel="image-{{image_counter}}">Remove Image</button>
                </div>
                % image_counter += 1
            % end
            <div>
                <label for="new-image-0">New Image 1:</label>
                <input type="file" id="new-image-0" accept="image/gif, image/jpeg, image/png" name="new-image-0" />
            </div>
        </div>
        <div>
            <input type="hidden" id="image-counter" name="image-counter" value="{{image_counter}}" />
            <input type="hidden" id="new-image-counter" name="new-image-counter" value="1" />
            <button id="add-image">Add Image</button>
        </div>

        <div>
            <button type="submit" name="edit">{{'Edit' if recipe.id else 'Create'}} Recipe</button>
            % if recipe.id:
                <button type="submit" name="delete">Delete Recipe</button>
            % end
        </div>
    </fieldset>
</form>

% rebase html_body id='manage-recipe', title='Recipe'